<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sopa de Letras IOA</title>

<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        background: #f2f2f2;
        padding: 20px;
    }

    h1 { font-size: 22px; }

    #grid {
        display: grid;
        margin: 20px auto;
        gap: 3px;
        user-select: none;
    }

    .cell {
        width: 28px;
        height: 28px;
        background: white;
        border: 1px solid #aaa;
        font-size: 18px;
        display: flex;
        justify-content: center;
        align-items: center;
        touch-action: none;
    }

    .selected {
        background: #7db3ff;
        color: white;
    }

    .correct {
        background: #3cb371;
        color: white;
    }

    #words {
        margin-top: 20px;
        text-align: left;
        max-width: 300px;
        margin-left: auto;
        margin-right: auto;
    }

    .found {
        text-decoration: line-through;
        color: green;
        font-weight: bold;
    }

    button {
        margin-top: 20px;
        padding: 10px 20px;
        font-size: 16px;
    }

    @media(max-width:600px){
        .cell{
            width: 24px;
            height: 24px;
            font-size: 15px;
        }
    }
</style>
</head>
<body>

<h1>Sopa de Letras — Depósitos IOA</h1>

<div id="grid"></div>

<h3>Palabras</h3>
<div id="words"></div>

<button onclick="reiniciar()">Reiniciar</button>

<script>
const words = [
    "HIDROTERMAL","ELLACO","HIERRO","ALBITIZACION","APATITO",
    "CLINOZOISITA","MAGNETITA","HEMATITA","ACTINOLITA",
    "SUBDUCCION","ARCOVOLCANICO","ALTERACION","PROPILITICA",
    "CALCOSODICA","METASOMATISMO"
];

const size = 20;
let grid = [];
let seleccion = [];
let seleccionCeldas = [];
let encontrado = new Set();

// Crear grilla vacía
function crearMatriz() {
    grid = Array(size).fill().map(()=>Array(size).fill(""));
}

// Insertar palabras horizontal/vertical
function colocarPalabras() {
    const dirs = [
        [0,1], // horizontal
        [1,0]  // vertical
    ];

    words.forEach(word=>{
        let colocado = false;
        while(!colocado){
            let dir = dirs[Math.floor(Math.random()*dirs.length)];
            let row = Math.floor(Math.random()*size);
            let col = Math.floor(Math.random()*size);

            if (cabefit(row,col,dir,word)){
                for (let i=0;i<word.length;i++){
                    grid[row + dir[0]*i][col + dir[1]*i] = word[i];
                }
                colocado = true;
            }
        }
    });
}

function cabefit(r,c,d,w){
    if (r + d[0]*w.length < 0 || r + d[0]*w.length > size) return false;
    if (c + d[1]*w.length < 0 || c + d[1]*w.length > size) return false;
    return true;
}

// Llenar con letras aleatorias
function rellenar() {
    const letras = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    for (let r=0;r<size;r++){
        for (let c=0;c<size;c++){
            if (grid[r][c] === "")
                grid[r][c] = letras[Math.floor(Math.random()*letras.length)];
        }
    }
}

// Dibujar grilla
function dibujar() {
    const cont = document.getElementById("grid");
    cont.style.gridTemplateColumns = `repeat(${size}, 28px)`;
    cont.innerHTML="";

    for (let r=0;r<size;r++){
        for (let c=0;c<size;c++){
            const div = document.createElement("div");
            div.className="cell";
            div.textContent=grid[r][c];
            div.dataset.row=r;
            div.dataset.col=c;

            div.addEventListener("mousedown", startSelect);
            div.addEventListener("mouseover", moveSelect);
            div.addEventListener("mouseup", endSelect);

            // táctil
            div.addEventListener("touchstart", startSelect);
            div.addEventListener("touchmove", moveSelect);
            div.addEventListener("touchend", endSelect);

            cont.appendChild(div);
        }
    }
}

// Manejo de selección
let selecting = false;

function startSelect(e){
    e.preventDefault();
    selecting = true;
    limpiarSeleccion();
    seleccionarCelda(e.target);
}

function moveSelect(e){
    if (!selecting) return;
    const touch = e.touches ? document.elementFromPoint(
        e.touches[0].clientX, e.touches[0].clientY
    ) : e.target;

    if (touch && touch.classList.contains("cell")){
        seleccionarCelda(touch);
    }
}

function endSelect(){
    selecting = false;
    verificar();
}

function seleccionarCelda(cell){
    if (seleccionCeldas.includes(cell)) return;
    seleccionCeldas.push(cell);
    seleccion.push(cell.textContent);
    cell.classList.add("selected");
}

function limpiarSeleccion(){
    seleccion = [];
    seleccionCeldas.forEach(c => c.classList.remove("selected"));
    seleccionCeldas = [];
}

// Verificar palabra
function verificar(){
    let palabra = seleccion.join("");

    if (words.includes(palabra) && !encontrado.has(palabra)){
        encontrado.add(palabra);
        seleccionCeldas.forEach(c => c.classList.add("correct"));
        document.getElementById(palabra).classList.add("found");
    } else {
        // incorrecto → borrar
        seleccionCeldas.forEach(c => c.classList.remove("selected"));
    }

    seleccion = [];
    seleccionCeldas = [];
}

// Mostrar lista de palabras
function mostrarPalabras(){
    const cont = document.getElementById("words");
    cont.innerHTML = "";
    words.forEach(w=>{
        cont.innerHTML += `<div id="${w}">${w}</div>`;
    });
}

// Reiniciar
function reiniciar(){
    encontrado.clear();
    crearTodo();
}

function crearTodo(){
    crearMatriz();
    colocarPalabras();
    rellenar();
    dibujar();
    mostrarPalabras();
}

crearTodo();
</script>

</body>
</html>

